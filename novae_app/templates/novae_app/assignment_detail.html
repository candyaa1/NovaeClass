{% load static %}
{% load custom_filters %}  {# <-- load your actual custom filter file #}

{% block title %}{{ instance.assignment.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>{{ instance.assignment.title }}</h1>
    <p><strong>Due Date:</strong> {{ instance.assignment.due_date }}</p>
    <p>{{ instance.assignment.description|default:"No description provided." }}</p>

    {% if instance.completed %}
        <div class="alert alert-success">
            <strong>Assignment Completed!</strong> Your score: {{ instance.score }}%
        </div>
        <a href="{% url 'graded_assignment_download' instance.id %}" class="btn btn-primary">
            Download Graded Assignment
        </a>
    {% else %}
        <form method="post">
            {% csrf_token %}
            {% if questions %}
                <ol>
                    {% for question in questions %}
                        <li class="mb-4">
                            <p>{{ question.question_text }}</p>

                            {% with answer=answers_by_question_id|dict_get:question.id %}
                                {% if question.is_text_answer %}
                                    <textarea class="form-control"
                                              name="question_{{ question.id }}"
                                              rows="4"
                                              placeholder="Type your answer here..."
                                              required>{% if answer %}{{ answer.text_answer }}{% endif %}</textarea>
                                {% else %}
                                    {% for option, label in [('A', question.option_a), ('B', question.option_b), ('C', question.option_c), ('D', question.option_d)] %}
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                   type="radio"
                                                   name="question_{{ question.id }}"
                                                   id="q{{ question.id }}{{ option }}"
                                                   value="{{ option }}"
                                                   required
                                                   {% if answer and answer.selected_option == option %}checked{% endif %}>
                                            <label class="form-check-label" for="q{{ question.id }}{{ option }}">{{ label }}</label>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            {% endwith %}
                        </li>
                    {% endfor %}
                </ol>
                <button type="submit" class="btn btn-success mt-3">Submit Assignment</button>
            {% else %}
                <p>No questions are available for this assignment.</p>
            {% endif %}
        </form>
    {% endif %}
</div>
{% endblock %}
