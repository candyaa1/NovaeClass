
<h1>{{ instance.assignment.title }}</h1>
<p>Due Date: {{ instance.assignment.due_date }}</p>

{% if instance.completed %}
    <p>Score: {{ instance.score|default:"Not graded yet" }}</p>
    <a href="{% url 'download_graded_assignment_docx' instance.id %}">Download Graded Assignment</a>

    <h3>Questions & Your Answers</h3>
    <ol>
        {% for question in questions %}
            <li>
                <p><strong>{{ question.question_text }}</strong></p>

                {% with answer=answers_dict|dict_get:question.id %}
                    {% if question.is_text_answer %}
                        <p>Your Answer: {{ answer.text_answer|default:"Not answered" }}</p>
                        {% if answer.is_correct %}
                            <span style="color:green">Correct ✅</span>
                        {% else %}
                            <span style="color:red">Incorrect ❌</span>
                        {% endif %}
                    {% else %}
                        <p>Your Answer: {{ answer.selected_option|default:"Not answered" }}</p>
                        {% if answer.is_correct %}
                            <span style="color:green">Correct ✅</span>
                        {% else %}
                            <span style="color:red">Incorrect ❌</span>
                        {% endif %}
                    {% endif %}
                {% endwith %}
            </li>
        {% endfor %}
    </ol>

{% else %}
    <form method="post">
        {% csrf_token %}
        <ol>
            {% for question in questions %}
                <li>
                    <p>{{ question.question_text }}</p>
                    {% if question.is_text_answer %}
                        <textarea name="question_{{ question.id }}" rows="4" placeholder="Type your answer here..."></textarea>
                    {% else %}
                        {% for opt in "ABCD" %}
                            <div>
                                <input type="radio" name="question_{{ question.id }}" value="{{ opt }}" id="q{{ question.id }}{{ opt }}">
                                <label for="q{{ question.id }}{{ opt }}">{{ question|get_option_text:opt }}</label>
                            </div>
                        {% endfor %}
                    {% endif %}
                </li>
            {% endfor %}
        </ol>
        <button type="submit">Submit Assignment</button>
    </form>
{% endif %}
