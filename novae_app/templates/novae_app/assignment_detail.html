{% load static %}

{% block title %}{{ instance.assignment.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>{{ instance.assignment.title }}</h1>
    <p><strong>Due Date:</strong> {{ instance.assignment.due_date }}</p>
    <p>{{ instance.assignment.description|default:"No description provided." }}</p>

    {% if instance.completed %}
        {% if instance.score >= 70 %}
            <div class="alert alert-success">
                <strong>Assignment Passed!</strong> Your score: {{ instance.score|floatformat:2 }}%
            </div>
        {% else %}
            <div class="alert alert-warning">
                <strong>Assignment Completed!</strong> Your score: {{ instance.score|floatformat:2 }}% â€” Below passing grade
            </div>
        {% endif %}

        <a href="{% url 'graded_assignment_download' instance.id %}" class="btn btn-primary mt-2">
            Download Graded Assignment
        </a>
    {% else %}
        <form method="post">
            {% csrf_token %}
            {% if questions %}
                <ol>
                    {% for question in questions %}
                        <li class="mb-4">
                            <p>{{ question.question_text }}</p>

                            {% if question.is_text_answer %}
                                <!-- Text answer -->
                                <textarea class="form-control" name="question_{{ question.id }}" rows="4" placeholder="Type your answer here..." required>{% if answers_by_question_id|default:{} %}{{ answers_by_question_id|dict_key:question.id.text_answer }}{% endif %}</textarea>
                            {% else %}
                                <!-- Multiple choice -->
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="q{{ question.id }}a" value="A" required
                                        {% if answers_by_question_id|default:{}|dict_key:question.id.selected_option == "A" %}checked{% endif %}>
                                    <label class="form-check-label" for="q{{ question.id }}a">{{ question.option_a }}</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="q{{ question.id }}b" value="B"
                                        {% if answers_by_question_id|default:{}|dict_key:question.id.selected_option == "B" %}checked{% endif %}>
                                    <label class="form-check-label" for="q{{ question.id }}b">{{ question.option_b }}</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="q{{ question.id }}c" value="C"
                                        {% if answers_by_question_id|default:{}|dict_key:question.id.selected_option == "C" %}checked{% endif %}>
                                    <label class="form-check-label" for="q{{ question.id }}c">{{ question.option_c }}</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="q{{ question.id }}d" value="D"
                                        {% if answers_by_question_id|default:{}|dict_key:question.id.selected_option == "D" %}checked{% endif %}>
                                    <label class="form-check-label" for="q{{ question.id }}d">{{ question.option_d }}</label>
                                </div>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ol>
                <button type="submit" class="btn btn-success mt-3">Submit Assignment</button>
            {% else %}
                <p>No questions are available for this assignment.</p>
            {% endif %}
        </form>
    {% endif %}
</div>
{% endblock %}
